#!/bin/bash
# 4-step toggle for Waybar icons
# Made by sleekmason for Waydog 21 Feb 2026

CONFIG="$HOME/.config/waybar/config.jsonc"

LONG=21
SHORT=12

current=$(awk '/"wlr\/taskbar": {/,/}/ { if($0 ~ /"format":/) print }' "$CONFIG" \
          | grep -Po '"format":\s*"\K[^"]+')

case "$current" in
    "{title:.$LONG}" | "{title:.$SHORT}")
        new="{icon}"
        notify-send -i preferences-desktop-personal "icons only"
        ;;
    "{icon}")
        new="{icon} {title:.$LONG}"
        notify-send -i preferences-desktop-personal "text + icons - long"
        ;;
    "{icon} {title:.$LONG}")
        new="{icon} {title:.$SHORT}"
        notify-send -i preferences-desktop-personal "text + icons - compact"
        ;;
    "{icon} {title:.$SHORT}")
        new="{title:.$LONG}"
        notify-send -i preferences-desktop-personal "text only"
        ;;
    *)
        new="{icon} {title:.$LONG}"
        notify-send -i preferences-desktop-personal "text + icons - long"
        ;;
esac

sed -i '/"wlr\/taskbar": {/,/}/ s/^\(\s*"format":\s*\)".*"/\1"'"$new"'"/' "$CONFIG"

pkill -x waybar
waybar &
