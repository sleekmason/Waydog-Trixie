#!/bin/bash
read -p "   [0;33mNiri Compositor Installer[0m

   Niri is a scrollable-tiling Wayland compositor. This script will
   install Niri, and provide a ~/.config/niri/config.kdl placed for
   initial Waydog settings. 
   
   There are many options to customize further.
   
   [0;32mhttps://yalter.github.io/niri/[0m
   
   [0;32m----------------------------------------------------------------

   Please press enter to install the Niri Compositor.

   ----------------------------------------------------------------[0m

   Or, close this terminal window to quit the install." ;
## Make sure of internet connection.
if : >/dev/tcp/8.8.8.8/53; then

echo ""
cd /tmp || exit
rm -f "niri-trixie.zip"
rm -fr "niri"
wget https://raw.githubusercontent.com/sleekmason/packages/master/niri-trixie.zip --show-progress -q || exit
unzip -q "/tmp/niri-trixie.zip"
cd /tmp/niri
sudo apt update
sudo apt install -y ./niri_25.11-1_amd64.deb || exit

## Make a regular backup each time.
if [ -e "$HOME/.config/niri" ]; then
   if [ -e "$HOME/.config/niri.bak" ]; then
   rm -f -r "$HOME/.config/niri.bak"
   cp -r "$HOME/.config/niri" "$HOME/.config/niri.bak"
else
   cp -r "$HOME/.config/niri" "$HOME/.config/niri.bak"
   fi
fi

## Copy files from /tmp.
mkdir -p "$HOME/.config/niri"
mkdir -p "$HOME/.config/waybar/niri"
cp -f "/tmp/niri/config.kdl" "$HOME/.config/niri"
sudo cp -f "/tmp/niri/xwayland-satellite" "/usr/local/bin"
sudo cp -f "/tmp/niri/random-nonoti" "/usr/local/bin"
sudo cp -f "/tmp/niri/waybar-toggle" "/usr/local/bin"
cp -f "/tmp/niri/config.jsonc" "$HOME/.config/waybar/niri"

## Explain items.
echo "   [0;32m--------------------------------------------------------[0m"
echo ""
echo "   [0;33mAll Finished![0m"
echo ""
echo "   [0;32mYou should find a new login entry for Niri.[0m"
echo ""
echo "   [0;32m--------------------------------------------------------[0m"
echo ""
else
echo ""
 echo "   [0;31m-----------------------------------------------------[0m"
 echo ""
 echo "   [0;33mNo Internet connection. Please connect and try again.[0m"
 echo ""
 echo "   [0;31m-----------------------------------------------------[0m"
echo ""
fi
read -n1 -p " Press any key to quit this dialog ... "
