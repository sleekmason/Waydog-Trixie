#!/bin/bash
echo ""
read -p "   [0;33mSnap Installer[0m

   This will install Snapd and the Snap App Store, the app store 
   for Linux. A menu entry will be placed in the Quickgrab menu.
   
   Please note that the installation can take a while for a slow
   connection as snap searches for resources. About 7 minutes on
   a fairly decent connection here.
   
   [0;33mLogging out and back in will be necessary for installed items
   to be called from menu entries without the full path.[0m

   [0;34mhttps://snapcraft.io//[0m
   
   [0;32m-------------------------------------------------------------
   
   Please press enter to install Snap.
   
   -------------------------------------------------------------[0m
   
   
   Or close this terminal window to quit the install." ;
   if : >/dev/tcp/8.8.8.8/53; then
full_fs=$(df ~ | tail -1 | awk '{print $1;}')  # find partition
fs=$(basename "$full_fs")
if grep -q "$fs" /proc/partitions; then
echo ""
sudo apt update && sudo apt install -y snapd &&
sleep 2
echo
#echo "[0;32mRestarting Snapd...[0m"
#sudo systemctl restart snapd snapd.socket &&
#sleep 4
#sudo systemctl daemon-reload &&
#echo
echo "[0;32mEnabling and starting snapd service...[0m"
sudo systemctl enable --now snapd.service &&
sleep 2
echo
echo "[0;32mInstalling the Snap Store ... This can take a while.[0m"
sudo snap install snap-store &&
sleep 2
# for i in $(snap connections | grep gtk-common-themes:gtk-3-themes | awk '{print $2}'); do sudo snap connect $i gtk-common-themes:gtk-3-themes; done &&
sed -i '/Snap Store,         \/snap\/bin\/snap-store,              preferences-other/d' ~/.config/jgmenu/prepend.csv &&
sed -i '/Root Folders,^checkout(rootfiles),folder/a Snap Store,         /snap/bin/snap-store,              preferences-other' ~/.config/jgmenu/prepend.csv
killall -q jgmenu
echo ""
echo ""
echo ""
echo "---------------------------------------------------------------"
echo ""
echo "[0;32mAll finished![0m"
echo ""
echo "[0;33mYou should find a Snap Store entry in the Quickgrab Menu. [0m" 
echo "" 
echo "[0;33mRemember, logging out and back in will be necessary for use.[0m"
echo "" 
echo "[0;32mMenu entries will need to be removed manually if uninstalled." 
echo "See Jgmenu Conf under Configuration in the menu for directions.[0m"
echo ""
echo "---------------------------------------------------------------"
else
echo "" 
echo "[0;32mPlease install Beardog to use Snap. Exiting...[0m"
echo ""
fi
else
echo ""
 echo "   [0;31m-----------------------------------------------------[0m"
 echo ""
 echo "   [0;33mNo Internet connection. Please connect and try again.[0m"
 echo ""
 echo "   [0;31m-----------------------------------------------------[0m"
echo ""
fi
read -n1 -p " Press any key to quit this dialog ... "
